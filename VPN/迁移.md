### 服务从传统架构迁移到云原生架构

#### 源头完全迁移到云效Git仓库

1. 代码存储完全从gitlab迁移到云效的Git仓库，下线了原先自主搭建的gitlab仓库
2. 云效提供了免费的git仓库能力，节省了一部分费用

##### **gitlab 与 云效仓库对应关系**

| **gitlab**                | **云效**              |
| ------------------------- | --------------------- |
| fc_frontend/*             | frontend/fc/*         |
| fc_backend/*              | backend/fc/*          |
| pd/*                      | design/*              |
| zeda-assistant-frontend/* | frontend/lvxiangyun/* |
| zeda-assistant-backend/*  | backend/lvxiangyun/*  |

#### 借助云效流水线能力替换传统的 Jenkins 方案

1. 梳理原先所有的 CI/CD 方案，统一原先重复的流程
2. 避免了之前jenkins构建是占用大量资源的问题
3. 下线了jenkins服务，构建服务器完全由云效提供
4. 统一了CI产物只有 docker 镜像，同时采用 helm 方案完成CD流程，且不保存 helm chart
5. 不会再出现阿里云机器重启服务宕机不能自动恢复的情况，k8s节点宕机后，服务会主动漂移

#### 中间件迁移

1. 原先多个环境使用同一套MySQL，Redis，RabbitMQ，迁移后每个环境中间件独立
2. 避免了代码里区分不同环境的中间件，代码相对来说更清晰

#### 统一原先复杂繁琐的方案

1. 统一服务端口，放弃原先基于ECS端口直连的方式，避免需要记录各种服务端口的方式，统一到 http 80, https 443
2. 原先的入口流量采用了同一个nginx做转发，配置太过于复杂繁琐，容易出错，且不同环境配置有不同
3. 中间件访问方式改成 VPN 方式访问，不在对外暴露
4. 由于原来采用一个 Nginx 做转发，导致 gateway 采用了存在了很多直连域名的操作，迁移后去除了所有域名判断
5. 原先只有不同环境只有一个域名入口，现在不同环境不同服务域名相互独立

